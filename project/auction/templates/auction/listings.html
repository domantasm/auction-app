{% extends "auction/index.html" %}
{% load static %}

{% block content %}
  <div class="table-responsive">
  <h2>Current Listings</h2>
  <form id="search-form">
    <div class="form-group">
      <input id="search-value" class="form-control" type="text" name="search" placeholder="Search">
    </div>
    <button type="submit">Search</button>
  </form>
  <div class="row">
    <div class="col-12">
		<table id="listings-table" class="table table-image">
    {% if items %} {% for item in items %}
		  <tbody>
		    <tr>
		      <th scope="row"></th>
		      <td class="w-25">
			      <img src="{{ item.image.url }}" class="img-fluid img-thumbnail" width="250px">
		      </td>
		      <td>{{ item.title }}</td>
		      <td>{{ item.description }}</td>
		      <td>{{ item.price }}</td>
		    </tr>
		  </tbody>
      {% endfor %}
		</table>
    {% else %}
    <p>No items currently listed</p>
    {% endif %}
    </div>
  </div>

</div>


<script type="text/javascript">
  $('#search-form').submit(function(e) {
    e.preventDefault();
    let search = $('#search-value').val();
    if(!search) {
      search = '';
    }
    let csrf = $("input[name=csrfmiddlewaretoken]").val();
    $.ajax({
      url: "/auction/listings/search/",
      type: "GET",
      data: {
        search: search
      },
      success: function(resp){
        let results = JSON.parse(resp);
        $('#listings-table').html('');
        let tabledata = '';
        for(let data of results) {
          tabledata += `<tbody><tr><th scope="row"></th><td class="w-25"><img src="/media/${data.fields.image}" class="img-fluid img-thumbnail" width="250px"></td><td>${data.fields.title}</td><td>${data.fields.description}</td><td>${data.fields.price}</td></tr></tbody>`;
        }
        $('#listings-table').html($(tabledata));
      },
      error: (er) => {}
    });
  })
</script>

{% endblock %}
